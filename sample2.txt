package hubapi

import (
	"fmt"
	"time"
)

type CodeLocationList struct {
	ItemsListBase
	Items []CodeLocation `json:"items"`
}

type CodeLocation struct {
	Name                 string     `json:"name"`
	Type                 string     `json:"type"`
	URL                  string     `json:"url"`
	ScanSize             int        `json:"scanSize"`
	MappedProjectVersion string     `json:"mappedProjectVersion"`
	CreatedAt            *time.Time `json:"createdAt"`
	UpdatedAt            *time.Time `json:"updatedAt"`
	Meta                 Meta       `json:"_meta"`
}

type ScanSummaryList struct {
	ItemsListBase
	Items []ScanSummary `json:"items"`
}

type ScanSummary struct {
	Status    string     `json:"status"`
	CreatedAt *time.Time `json:"createdAt"`
	UpdatedAt *time.Time `json:"updatedAt"`
	Meta      Meta       `json:"_meta"`
}

// I wonder if these can exist to make request as well...
// Or maybe add something to the link itself to make the request?

func (c *CodeLocation) GetScanSummariesLink() (*ResourceLink, error) {
	return c.Meta.FindLinkByRel("scans")
}

func (c *CodeLocation) GetProjectVersionLink() (*ResourceLink, error) {
	if c.MappedProjectVersion == "" {
		return nil, fmt.Errorf("empty mapped project version")
	}
	return &ResourceLink{Href: c.MappedProjectVersion}, nil
}

func (s *ScanSummary) GetCodeLocationLink() (*ResourceLink, error) {
	return s.Meta.FindLinkByRel("codelocation")
}
